!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).geometryExtrude={})}(this,function(e){"use strict";var w=r,t=r;function r(e,t,r){r=r||2;var n,i,o,a,v,h,u,l=t&&t.length,f=l?t[0]*r:e.length,x=p(e,0,f,r,!0),s=[];if(!x||x.next===x.prev)return s;if(l&&(x=function(e,t,r,n){var i,o,a,v,h,u=[];for(i=0,o=t.length;i<o;i++)a=t[i]*n,v=i<o-1?t[i+1]*n:e.length,(h=p(e,a,v,n,!1))===h.next&&(h.steiner=!0),u.push(b(h));for(u.sort(g),i=0;i<u.length;i++)r=d(r=m(u[i],r),r.next);return r}(e,t,x,r)),e.length>80*r){n=o=e[0],i=a=e[1];for(var c=r;c<f;c+=r)(v=e[c])<n&&(n=v),(h=e[c+1])<i&&(i=h),o<v&&(o=v),a<h&&(a=h);u=0!==(u=Math.max(o-n,a-i))?1/u:0}return y(x,s,r,n,i,u),s}function p(e,t,r,n,i){var o,a;if(i===0<P(e,t,r,n))for(o=t;o<r;o+=n)a=v(o,e[o],e[o+1],a);else for(o=r-n;t<=o;o-=n)a=v(o,e[o],e[o+1],a);return a&&c(a,a.next)&&(q(a),a=a.next),a}function d(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!c(n,n.next)&&0!==Z(n.prev,n,n.next))n=n.next;else{if(q(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function y(e,t,r,n,i,o,a){if(e){!a&&o&&function(e,t,r,n){var i=e;for(;null===i.z&&(i.z=M(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,a,v,h,u=1;do{for(r=e,o=e=null,a=0;r;){for(a++,n=r,t=v=0;t<u&&(v++,n=n.nextZ);t++);for(h=u;0<v||0<h&&n;)0!==v&&(0===h||!n||r.z<=n.z)?(r=(i=r).nextZ,v--):(n=(i=n).nextZ,h--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(1<a)}(i)}(e,n,i,o);for(var v,h,u=e;e.prev!==e.next;)if(v=e.prev,h=e.next,o?f(e,n,i,o):l(e))t.push(v.i/r),t.push(e.i/r),t.push(h.i/r),q(e),e=h.next,u=h.next;else if((e=h)===u){a?1===a?y(e=x(d(e),t,r),t,r,n,i,o,2):2===a&&s(e,t,r,n,i,o):y(d(e),t,r,n,i,o,1);break}}}function l(e){var t=e.prev,r=e,n=e.next;if(0<=Z(t,r,n))return!1;for(var i=e.next.next;i!==e.prev;){if(S(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&0<=Z(i.prev,i,i.next))return!1;i=i.next}return!0}function f(e,t,r,n){var i=e.prev,o=e,a=e.next;if(0<=Z(i,o,a))return!1;for(var v=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,h=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,u=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,f=M(v,h,t,r,n),x=M(u,l,t,r,n),s=e.prevZ,c=e.nextZ;s&&s.z>=f&&c&&c.z<=x;){if(s!==e.prev&&s!==e.next&&S(i.x,i.y,o.x,o.y,a.x,a.y,s.x,s.y)&&0<=Z(s.prev,s,s.next))return!1;if(s=s.prevZ,c!==e.prev&&c!==e.next&&S(i.x,i.y,o.x,o.y,a.x,a.y,c.x,c.y)&&0<=Z(c.prev,c,c.next))return!1;c=c.nextZ}for(;s&&s.z>=f;){if(s!==e.prev&&s!==e.next&&S(i.x,i.y,o.x,o.y,a.x,a.y,s.x,s.y)&&0<=Z(s.prev,s,s.next))return!1;s=s.prevZ}for(;c&&c.z<=x;){if(c!==e.prev&&c!==e.next&&S(i.x,i.y,o.x,o.y,a.x,a.y,c.x,c.y)&&0<=Z(c.prev,c,c.next))return!1;c=c.nextZ}return!0}function x(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!c(i,o)&&z(i,n,n.next,o)&&R(i,o)&&R(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),q(n),q(n.next),n=e=o),n=n.next}while(n!==e);return d(n)}function s(e,t,r,n,i,o){var a,v,h=e;do{for(var u=h.next.next;u!==h.prev;){if(h.i!==u.i&&(v=u,(a=h).next.i!==v.i&&a.prev.i!==v.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&z(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(a,v)&&(R(a,v)&&R(v,a)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next,r!==e;);return n}(a,v)&&(Z(a.prev,a,v.prev)||Z(a,v.prev,v))||c(a,v)&&0<Z(a.prev,a,a.next)&&0<Z(v.prev,v,v.next)))){var l=A(h,u);return h=d(h,h.next),l=d(l,l.next),y(h,t,r,n,i,o),void y(l,t,r,n,i,o)}u=u.next}h=h.next}while(h!==e)}function g(e,t){return e.x-t.x}function m(e,t){var r=function(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var v=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(v<=i&&a<v){if((a=v)===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r;var h,u=r,l=r.x,f=r.y,x=1/0;n=r;for(;i>=n.x&&n.x>=l&&i!==n.x&&S(o<f?i:a,o,l,f,o<f?a:i,o,n.x,n.y)&&(h=Math.abs(o-n.y)/(i-n.x),R(n,e)&&(h<x||h===x&&(n.x>r.x||n.x===r.x&&(c=n,Z((s=r).prev,s,c.prev)<0&&Z(c.next,s,s.next)<0)))&&(r=n,x=h)),n=n.next,n!==u;);var s,c;return r}(e,t);if(!r)return t;var n=A(r,e),i=d(r,r.next);return d(n,n.next),t===r?i:t}function M(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function b(e){for(var t=e,r=e;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),(t=t.next)!==e;);return r}function S(e,t,r,n,i,o,a,v){return 0<=(i-a)*(t-v)-(e-a)*(o-v)&&0<=(e-a)*(n-v)-(r-a)*(t-v)&&0<=(r-a)*(o-v)-(i-a)*(n-v)}function Z(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function c(e,t){return e.x===t.x&&e.y===t.y}function z(e,t,r,n){var i=u(Z(e,t,r)),o=u(Z(e,t,n)),a=u(Z(r,n,e)),v=u(Z(r,n,t));return i!==o&&a!==v||(!(0!==i||!h(e,r,t))||(!(0!==o||!h(e,n,t))||(!(0!==a||!h(r,e,n))||!(0!==v||!h(r,t,n)))))}function h(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function u(e){return 0<e?1:e<0?-1:0}function R(e,t){return Z(e.prev,e,e.next)<0?0<=Z(e,t,e.next)&&0<=Z(e,e.prev,t):Z(e,t,e.prev)<0||Z(e,e.next,t)<0}function A(e,t){var r=new a(e.i,e.x,e.y),n=new a(t.i,t.x,t.y),i=e.next,o=t.prev;return(e.next=t).prev=e,(r.next=i).prev=r,(n.next=r).prev=n,(o.next=n).prev=o,n}function v(e,t,r,n){var i=new a(e,t,r);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i}function q(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function a(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function P(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}function V(e,t,r){var n=t[0],i=t[1],o=r[0]-n,a=r[1]-i;if(0!==o||0!==a){var v=((e[0]-n)*o+(e[1]-i)*a)/(o*o+a*a);1<v?(n=r[0],i=r[1]):0<v&&(n+=o*v,i+=a*v)}return(o=e[0]-n)*o+(a=e[1]-i)*a}function i(e,t){var r=e.length-1,n=[e[0]];return function e(t,r,n,i,o){for(var a,v=i,h=r+1;h<n;h++){var u=V(t[h],t[r],t[n]);v<u&&(a=h,v=u)}i<v&&(1<a-r&&e(t,r,a,i,o),o.push(t[a]),1<n-a&&e(t,a,n,i,o))}(e,0,r,t,n),n.push(e[r]),n}function B(e,t,r){if(e.length<=2)return e;var n=void 0!==t?t*t:1;return e=i(e=r?e:function(e,t){for(var r,n,i,o,a,v=e[0],h=[v],u=1,l=e.length;u<l;u++)r=e[u],i=v,o=(n=r)[0]-i[0],a=n[1]-i[1],t<o*o+a*a&&(h.push(r),v=r);return v!==r&&h.push(r),h}(e,n),n)}function H(e,t){return e[0]*t[0]+e[1]*t[1]}function K(e,t){var r=t[0],n=t[1],i=Math.sqrt(r*r+n*n);return e[0]=r/i,e[1]=n/i,e}function F(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function Q(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function O(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}r.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,a=Math.abs(P(e,0,o,r));if(i)for(var v=0,h=t.length;v<h;v++){var u=t[v]*r,l=v<h-1?t[v+1]*r:e.length;a-=Math.abs(P(e,u,l,r))}var f=0;for(v=0;v<n.length;v+=3){var x=n[v]*r,s=n[v+1]*r,c=n[v+2]*r;f+=Math.abs((e[x]-e[c])*(e[s+1]-e[x+1])-(e[x]-e[s])*(e[c+1]-e[x+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},r.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[i][o][a]);0<i&&(n+=e[i-1].length,r.holes.push(n))}return r},w.default=t;var j=[];function le(e,t,r,n){var i,o,a,v,h,u,l,f,x,s,c,p=(o=r,(i=t)[0]*o[0]+i[1]*o[1]+i[2]*o[2]),d=Math.acos(p)*n;return F(j,r,t,-p),h=(v=a=j)[0],u=v[1],l=v[2],f=Math.sqrt(h*h+u*u+l*l),a[0]=h/f,a[1]=u/f,a[2]=l/f,x=e,s=t,c=Math.cos(d),x[0]=s[0]*c,x[1]=s[1]*c,x[2]=s[2]*c,F(e,e,j,Math.sin(d)),e}function U(e,t,r){if(r-t<3)return 0;for(var n=0,i=2*(r-1),o=2*t;o<2*r;){var a=e[i],v=e[i+1],h=e[o],u=e[o+1];i=o,o+=2,n+=a*u-h*v}return n}function k(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2;return w(e,t,r)}var X=[],Y=[],$=[];function L(e,t,r,n,i,o,a,v,h){var u=null!=a,l=i,f=null;u&&(f=new Uint32Array(n-r));for(var x,s,c,p,d,y,g,m,M,b,w,S=void 0,Z=void 0,z=void 0,R=[],A=r;A<n;A++){var q=A===n-1?r:A+1,P=A===r?n-1:A-1,V=e[2*P],B=e[2*P+1],F=e[2*A],O=e[2*A+1],j=e[2*q],U=e[2*q+1];X[0]=F-V,X[1]=O-B,Y[0]=j-F,Y[1]=U-O,K(X,X),K(Y,Y),u&&(f[A]=l);var k=!1,L=void 0,T=void 0;if(v||A!==r)if(v||A!==n-1){Q($,Y,X);var W=$[1];$[1]=-$[0],$[0]=W,K($,$);var E=H($,Y),I=Math.sqrt(1-E*E),_=o*Math.min(10,1/I);if(u&&a<1/I&&o*E<0){var D=F+$[0]*o,G=O+$[1]*o,J=Math.acos(I)/2,N=Math.tan(J)*Math.abs(o);t[2*l]=D+$[1]*N,t[2*l+1]=G-$[0]*N,t[2*++l]=D-$[1]*N,t[2*l+1]=G+$[0]*N,l++}else L=F+$[0]*_,T=O+$[1]*_,k=!0;if(k){if(h&&null!=S){var C=(void(m=0),w=((M=L-(d=F))*((s=B)-(y=O))-(b=T-y)*((x=V)-d))/(b*((c=S)-x)-M*((p=Z)-s)),(g=R)&&(g[m=m||0]=x+w*(c-x),g[m+1]=s+w*(p-s)),w);-.01<=C&&C<=1.01&&(t[2*z]=L=R[0],t[2*z+1]=T=R[1])}S=t[2*l]=L,Z=t[2*l+1]=T,z=l,l++}}else $[0]=X[1],$[1]=-X[0],K($,$),L=F+$[0]*o,T=O+$[1]*o,k=!0;else $[0]=Y[1],$[1]=-Y[0],K($,$),S=t[2*l]=F+$[0]*o,Z=t[2*l+1]=O+$[1]*o,z=l,l++}return f}function T(e,t,r,n,i,o,a,v){var h=null!=a,u=i,l=null;h&&(l=new Uint32Array(n-r));for(var f=r;f<n;f++){var x=f===n-1?r:f+1,s=f===r?n-1:f-1,c=e[2*s],p=e[2*s+1],d=e[2*f],y=e[2*f+1],g=e[2*x],m=e[2*x+1];if(X[0]=d-c,X[1]=y-p,Y[0]=g-d,Y[1]=m-y,K(X,X),K(Y,Y),h&&(l[f]=u),v||f!==r)if(v||f!==n-1){Q($,Y,X);var M=$[1];$[1]=-$[0],$[0]=M,K($,$);var b=H($,Y),w=Math.sqrt(1-b*b),S=o*Math.min(10,1/w);if(h&&a<1/w&&o*b<0){var Z=d+$[0]*o,z=y+$[1]*o,R=Math.acos(w)/2,A=Math.tan(R)*Math.abs(o);t[2*u]=Z+$[1]*A,t[2*u+1]=z-$[0]*A,t[2*++u]=Z-$[1]*A,t[2*u+1]=z+$[0]*A,u++}else t[2*u]=d+$[0]*S,t[2*u+1]=y+$[1]*S,u++}else $[0]=X[1],$[1]=-X[0],K($,$),t[2*u]=d+$[0]*o,t[2*u+1]=y+$[1]*o,u++;else $[0]=Y[1],$[1]=-Y[0],K($,$),t[2*u]=d+$[0]*o,t[2*u+1]=y+$[1]*o,u++}return l}function W(e,t,r,n,i){var o=null!=n?[]:new Float32Array(e.length);if(L(e,o,0,t&&t.length?t[0]:e.length/2,0,r,n,i,!0),t)for(var a=0;a<t.length;a++){var v=t[a];L(e,o,v,t[a+1]||e.length/2,null!=n?o.length/2:v,r,n,i,!1)}return o}function E(e,t,r,n){for(var i=0;i<Math.floor((n-r)/2);i++)for(var o=0;o<t;o++){var a=(i+r)*t+o,v=(n-i-1)*t+o,h=e[a];e[a]=e[v],e[v]=h}return e}function I(e,t){var r=e.length/2,n=0,i=t&&t.length?t[0]:r;0<U(e,n,i)&&E(e,2,n,i);for(var o=1;o<(t?t.length:0)+1;o++)U(e,n=t[o-1],i=t[o]||r)<0&&E(e,2,n,i)}function _(e){e.depth=e.depth||1,e.bevelSize=e.bevelSize||0,e.bevelSegments=null==e.bevelSegments?2:e.bevelSegments,e.smoothBevel=e.smoothBevel||!1,e.simplify=e.simplify||0,null==e.smoothSide&&(e.smoothSide="auto"),null==e.smoothSideThreshold&&(e.smoothSideThreshold=.9),"number"==typeof e.depth&&(e.bevelSize=Math.min(0<e.bevelSegments?e.bevelSize:0,e.depth/2)),0<e.bevelSize||(e.bevelSegments=0),e.bevelSegments=Math.round(e.bevelSegments);var t=e.boundingRect;if(e.translate=e.translate||[0,0],e.scale=e.scale||[1,1],e.fitRect){var r=null==e.fitRect.x?t.x||0:e.fitRect.x,n=null==e.fitRect.y?t.y||0:e.fitRect.y,i=e.fitRect.width,o=e.fitRect.height;null==i?null!=o?i=o/t.height*t.width:(i=t.width,o=t.height):null==o&&(o=i/t.width*t.height),e.scale=[i/t.width,o/t.height],e.translate=[(r-t.x)*e.scale[0],(n-t.y)*e.scale[1]]}}var fe=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];function D(e,t,r){for(var n=0,i=e[t],o=e[t+1],a=i,v=o,h=t+2;h<r;h+=2){var u=e[h],l=e[h+1];n+=Math.sqrt((u-i)*(u-i)+(l-o)*(l-o)),i=u,o=l}return n+=Math.sqrt((i-a)*(i-a)+(o-v)*(o-v))}function G(e,t,r,n,i,o){var a=t.vertices,v=t.topVertices,h=t.splittedMap,u=t.depth,l=t.rect,f=n-r,x=o.smoothBevel?1:2,s=Math.min(u/2,o.bevelSize),c=o.bevelSegments,p=i.vertex,d=i.ringPerimeter,y=Math.max(l.width,l.height,u,d);function g(e){var t=(e+1)%f,r=a[2*e],n=a[2*e+1],i=a[2*t],o=a[2*t+1];return r===i&&n===o}if(0<s)for(var m=[0,0,1],M=[],b=[0,0,-1],w=[],S=0,Z=new Float32Array(f),z=0;z<2;z++)for(var R=0===z?u-s:s,A=0;A<=c*x;A++){for(var q=0,P=void 0,V=void 0,B=0;B<f;B++){var F=2*(B%f+r),O=h?2*h[F/2]:F;M[0]=a[F]-v[O],M[1]=a[F+1]-v[O+1],M[2]=0;var j=Math.sqrt(M[0]*M[0]+M[1]*M[1]);M[0]/=j,M[1]/=j;var U=(Math.floor(A/x)+A%x)/c;0===z?le(w,m,M,U):le(w,M,b,U);var k=0===z?U:1-U,L=s*Math.sin(k*Math.PI/2),T=j*Math.cos(k*Math.PI/2),W=s*j/Math.sqrt(L*L+T*T),E=w[0]*W+v[O],I=w[1]*W+v[O+1],_=w[2]*W+R;if(e.position[3*i.vertex]=E,e.position[3*i.vertex+1]=I,e.position[3*i.vertex+2]=_,0<B&&(q+=Math.sqrt((P-E)*(P-E)+(V-I)*(V-I))),0<A||0<z){var D=3*(i.vertex-f),G=e.position[D],J=e.position[D+1],N=e.position[D+2];Z[B]+=Math.sqrt((G-E)*(G-E)+(J-I)*(J-I)+(N-_)*(N-_))}if(e.uv[2*i.vertex]=q/y,e.uv[2*i.vertex+1]=Z[B]/y,P=E,V=I,i.vertex++,!g(B)&&(1<x&&A%x||1===x&&1<=A))for(var C=0;C<6;C++){var H=(fe[C][0]+B)%f,K=fe[C][1]+S;e.indices[i.index++]=(K-1)*f+H+p}}S++}else for(var Q=0;Q<2;Q++)for(var X=0===Q?u-s:s,Y=0,$=void 0,ee=void 0,te=0;te<f;te++){var re=2*(te%f+r),ne=a[re],ie=a[re+1];e.position[3*i.vertex]=ne,e.position[3*i.vertex+1]=ie,e.position[3*i.vertex+2]=X,0<te&&(Y+=Math.sqrt(($-ne)*($-ne)+(ee-ie)*(ee-ie))),e.uv[2*i.vertex]=Y/y,e.uv[2*i.vertex+1]=X/y,$=ne,ee=ie,i.vertex++}for(var oe=0<s?c*x+1:1,ae=0;ae<f;ae++)if(!g(ae))for(var ve=0;ve<6;ve++){var he=(fe[ve][0]+ae)%f,ue=fe[ve][1]+oe;e.indices[i.index++]=(ue-1)*f+he+p}}function J(e,t,r,n){var i=e.indices,o=e.topVertices,a=e.rect,v=e.depth;if(!(o.length<=4)){for(var h=r.vertex,u=i.length,l=0;l<u;l++)t.indices[r.index++]=h+i[l];for(var f=Math.max(a.width,a.height),x=0;x<(n.excludeBottom?1:2);x++)for(var s=0;s<o.length;s+=2){var c=o[s],p=o[s+1];t.position[3*r.vertex]=c,t.position[3*r.vertex+1]=p,t.position[3*r.vertex+2]=(1-x)*v,t.uv[2*r.vertex]=(c-a.x)/f,t.uv[2*r.vertex+1]=(p-a.y)/f,r.vertex++}if(!n.excludeBottom)for(var d=o.length/2,y=0;y<u;y+=3)for(var g=0;g<3;g++)t.indices[r.index++]=h+d+i[y+2-g]}}function N(e,t,r,n){var i=null==r||"auto"===r;if(!0===r)return{vertices:e,holes:t};for(var o=[],a=t&&[],v=e.length/2,h=[],u=[],l=[],f=0,x=0,s=(t?t.length:0)+1,c=0;c<s;c++){0===c?x=t&&t.length?t[0]:v:(f=t[c-1],x=t[c]||v);for(var p=f;p<x;p++){var d=e[2*p],y=e[2*p+1],g=p===x-1?f:p+1,m=e[2*g],M=e[2*g+1];if(i){var b=p===f?x-1:p-1,w=e[2*b],S=e[2*b+1];h[0]=w-d,h[1]=S-y,u[0]=m-d,u[1]=M-y,K(h,h),K(u,u),n<1-(.5*H(h,u)+.5)?(o.push(d,y),l.push(p)):(o.push(d,y,d,y),l.push(p,p))}else o.push(d,y,d,y),l.push(p,p)}c<s-1&&a&&a.push(o.length/2)}return{vertices:new Float32Array(o),splittedMap:l,holes:a}}function C(e,t){for(var r=0,n=0,i=0;i<e.length;i++){var o=e[i],a=o.indices,v=o.vertices,h=o.splittedMap,u=o.topVertices,l=o.depth,f=0<Math.min(l/2,t.bevelSize)?t.bevelSegments:0,x=e[i].holes||[];r+=a.length*(t.excludeBottom?1:2),n+=u.length/2*(t.excludeBottom?1:2);for(var s=2+2*f,c=0,p=0,d=0;d<x.length+1;d++){0===d?p=x.length?x[0]:v.length/2:(c=x[d-1],p=x[d]||v.length/2),r+=6*((h?h[p-1]+1:p)-(h?h[c]:c))*(s-1);var y=p-c;n+=y*s+(t.smoothBevel?0:f*y*2)}}for(var g={position:new Float32Array(3*n),indices:new(65535<n?Uint32Array:Uint16Array)(r),uv:new Float32Array(2*n)},m={vertex:0,index:0,ringPerimeter:0},M=0;M<e.length;M++)J(e[M],g,m,t);for(var b=0;b<e.length;b++){var w=e[b],S=w.holes,Z=(v=w.vertices).length/2,z=0,R=S&&S.length?S[0]:Z;if(m.ringPerimeter=D(e[b].topVertices,z,R),G(g,e[b],z,R,m,t),S)for(var A=0;A<S.length;A++)z=S[A],R=S[A+1]||Z,m.ringPerimeter=D(e[b].topVertices,z,R),G(g,e[b],z,R,m,t)}for(var q=0;q<g.uv.length;q++){var P=g.uv[q];0<P&&Math.round(P)===P?g.uv[q]=1:g.uv[q]=P%1}return g.normal=function(e,t){function r(e,t,r,n){e[0]=t,e[1]=r,e[2]=n}for(var n,i,o,a,v,h,u,l,f,x,s,c,p,d,y,g=[],m=[],M=[],b=[],w=[],S=[],Z=e.length,z=new Float32Array(t.length),R=0;R<Z;){var A=3*e[R++],q=3*e[R++],P=3*e[R++];r(g,t[A],t[A+1],t[A+2]),r(m,t[q],t[q+1],t[q+2]),r(M,t[P],t[P+1],t[P+2]),O(b,g,m),O(w,m,M),n=S,o=w,a=(i=b)[0],v=i[1],h=i[2],u=o[0],l=o[1],f=o[2],n[0]=v*f-h*l,n[1]=h*u-a*f,n[2]=a*l-v*u;for(var V=0;V<3;V++)z[A+V]=z[A+V]+S[V],z[q+V]=z[q+V]+S[V],z[P+V]=z[P+V]+S[V]}for(var B=0;B<z.length;)r(S,z[B],z[B+1],z[B+2]),c=(s=x=S)[0],p=s[1],d=s[2],y=Math.sqrt(c*c+p*p+d*d),x[0]=c/y,x[1]=p/y,x[2]=d/y,z[B++]=S[0],z[B++]=S[1],z[B++]=S[2];return z}(g.indices,g.position),g.boundingRect=e[0]&&e[0].rect,g}function ee(e,t,r){for(var n=r.lineWidth,i=e.length,o=new Float32Array(2*i),a=r.translate||[0,0],v=r.scale||[1,1],h=0,u=0;h<i;h++)o[u++]=e[h][0]*v[0]+a[0],o[u++]=e[h][1]*v[1]+a[1];U(o,0,i)<0&&E(o,2,0,i);var l=[],f=[],x=r.miterLimit,s=T(o,f,0,i,0,-n/2,x,!1);E(o,2,0,i);for(var c=T(o,l,0,i,0,-n/2,x,!1),p=(l.length+f.length)/2,d=new Float32Array(2*p),y=0,g=f.length/2,m=0;m<f.length;m++)d[y++]=f[m];for(var M=0;M<l.length;M++)d[y++]=l[M];for(var b=new(65535<p?Uint32Array:Uint16Array)(3*(2*(i-1)+(p-2*i))),w=0,S=0;S<i-1;S++){var Z=S+1;b[w++]=g-1-s[S],b[w++]=g-1-s[S]-1,b[w++]=c[S]+1+g,b[w++]=g-1-s[S],b[w++]=c[S]+1+g,b[w++]=c[S]+g,c[Z]-c[S]==2?(b[w++]=c[S]+2+g,b[w++]=c[S]+1+g,b[w++]=g-s[Z]-1):s[Z]-s[S]==2&&(b[w++]=c[Z]+g,b[w++]=g-1-(s[S]+1),b[w++]=g-1-(s[S]+2))}var z=0<r.bevelSize?W(d,[],r.bevelSize,null,!0):d,R=r.boundingRect,A=N(d,null,r.smoothSide,r.smoothSideThreshold);return{vertices:A.vertices,rawVertices:z,splittedMap:A.splittedMap,indices:b,topVertices:z,rect:{x:R.x*v[0]+a[0],y:R.y*v[1]+a[1],width:R.width*v[0],height:R.height*v[1]},depth:"function"==typeof r.depth?r.depth(t):r.depth,holes:[]}}function te(e,t){for(var r=[],n=0;n<e.length;n++){for(var i=e[n],o=[],a=i.length,v=i[a-1][0],h=i[a-1][1],u=0,l=0;l<a;l++){var f=i[l][0],x=i[l][1],s=f-v,c=x-h;t<(u+=Math.sqrt(s*s+c*c))&&(o.push(i[l]),u=0),v=f,h=x}3<=o.length&&r.push(o)}return 0<r.length?r:null}function re(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];3<=(i=B(i,t,!0)).length&&r.push(i)}return 0<r.length?r:null}function ne(e,t){t=Object.assign({},t);for(var r=[1/0,1/0],n=[-1/0,-1/0],i=0;i<e.length;i++)oe(e[i][0],r,n);t.boundingRect=t.boundingRect||{x:r[0],y:r[1],width:n[0]-r[0],height:n[1]-r[1]},_(t);for(var o=[],a=t.translate||[0,0],v=t.scale||[1,1],h=t.boundingRect,u={x:h.x*v[0]+a[0],y:h.y*v[1]+a[1],width:h.width*v[0],height:h.height*v[1]},l=Math.min(h.width,h.height)/1e5,f=0;f<e.length;f++){var x=te(e[f],l);if(x){var s=t.simplify/Math.max(v[0],v[1]);if(0<s&&(x=re(x,s)),x){for(var c=w.flatten(x),p=c.vertices,d=c.holes,y=c.dimensions,g=0;g<p.length;)p[g]=p[g++]*v[0]+a[0],p[g]=p[g++]*v[1]+a[1];if(I(p,d),2!==y)throw new Error("Only 2D polygon points are supported");var m=0<t.bevelSize?W(p,d,t.bevelSize,null,!0):p,M=k(m,d,y),b=N(p,d,t.smoothSide,t.smoothSideThreshold);o.push({indices:M,vertices:b.vertices,rawVertices:p,topVertices:m,holes:b.holes,splittedMap:b.splittedMap,rect:u,depth:"function"==typeof t.depth?t.depth(f):t.depth})}}}return C(o,t)}function ie(e,t){t=Object.assign({},t);for(var r=[1/0,1/0],n=[-1/0,-1/0],i=0;i<e.length;i++)oe(e[i],r,n);t.boundingRect=t.boundingRect||{x:r[0],y:r[1],width:n[0]-r[0],height:n[1]-r[1]},_(t);var o=t.scale||[1,1];null==t.lineWidth&&(t.lineWidth=1),null==t.miterLimit&&(t.miterLimit=2);for(var a=[],v=0;v<e.length;v++){var h=e[v],u=t.simplify/Math.max(o[0],o[1]);0<u&&(h=B(h,u,!0)),a.push(ee(h,v,t))}return C(a,t)}function oe(e,t,r){for(var n=0;n<e.length;n++)t[0]=Math.min(e[n][0],t[0]),t[1]=Math.min(e[n][1],t[1]),r[0]=Math.max(e[n][0],r[0]),r[1]=Math.max(e[n][1],r[1])}e.triangulate=k,e.flatten=function(e){return w.flatten(e)},e.offsetPolygon=W,e.extrudePolygon=ne,e.extrudePolyline=ie,e.extrudeGeoJSON=function(t,e){e=Object.assign({},e);for(var r=[],n=[],i=[],o=[],a=[1/0,1/0],v=[-1/0,-1/0],h=0;h<t.features.length;h++){var u=t.features[h].geometry;if(u&&u.coordinates)switch(u.type){case"LineString":r.push(u.coordinates),i.push(h),oe(u.coordinates,a,v);break;case"MultiLineString":for(var l=0;l<u.coordinates.length;l++)r.push(u.coordinates[l]),i.push(h),oe(u.coordinates[l],a,v);break;case"Polygon":n.push(u.coordinates),o.push(h),oe(u.coordinates[0],a,v);break;case"MultiPolygon":for(var f=0;f<u.coordinates.length;f++)n.push(u.coordinates[f]),o.push(h),oe(u.coordinates[f][0],a,v)}}e.boundingRect=e.boundingRect||{x:a[0],y:a[1],width:v[0]-a[0],height:v[1]-a[1]};var x=e.depth;return{polyline:ie(r,Object.assign(e,{depth:function(e){return"function"==typeof x?x(t.features[i[e]]):x}})),polygon:ne(n,Object.assign(e,{depth:function(e){return"function"==typeof x?x(t.features[o[e]]):x}}))}},Object.defineProperty(e,"__esModule",{value:!0})});
